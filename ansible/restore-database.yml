---
- name: Restore PostgreSQL database
  hosts: localhost
  tasks:
    - name: Get the name of the postgres pod
      shell: kubectl get pods -l app=postgres -o jsonpath='{.items[0].metadata.name}'
      register: postgres_pod

    - name: Copy the backup.sql file to the postgres pod
      command: kubectl cp ./backup/backup.sql {{ postgres_pod.stdout }}:/tmp/backup.sql

    - name: Restore the database from backup.sql
      shell: |
        kubectl exec {{ postgres_pod.stdout }} -- bash -c \
          "PGPASSWORD=password psql -U postgres -d cfrs_db -f /tmp/backup.sql"
